---
description: React Native with Expo best practices for mobile app development
globs: ["**/*.tsx", "**/*.ts", "app/**/*", "src/**/*"]
alwaysApply: false
---

# React Native (Expo) Best Practices

## Overview

| Aspect | Recommendation |
|--------|----------------|
| Framework | Expo SDK 54+ |
| Router | Expo Router (file-based) |
| Styling | NativeWind (Tailwind) or StyleSheet |
| State | Zustand or React Context |
| Navigation | Stack, Tabs, Drawer via Expo Router |

---

## Project Structure

```
app/
├── (tabs)/                 # Tab navigator group
│   ├── _layout.tsx         # Tab layout config
│   ├── index.tsx           # Home tab
│   └── profile.tsx         # Profile tab
├── (auth)/                 # Auth flow group
│   ├── _layout.tsx
│   ├── login.tsx
│   └── register.tsx
├── [id].tsx                # Dynamic route
├── _layout.tsx             # Root layout
├── +not-found.tsx          # 404 page
└── modal.tsx               # Modal screen
components/
├── ui/                     # Reusable UI components
└── ...
hooks/
├── useAuth.ts
└── ...
lib/
├── api.ts
└── storage.ts
```

---

## Expo Router Navigation

### Root Layout

```tsx
// app/_layout.tsx
import { Stack } from 'expo-router'
import { useFonts } from 'expo-font'
import * as SplashScreen from 'expo-splash-screen'
import { useEffect } from 'react'

SplashScreen.preventAutoHideAsync()

export default function RootLayout() {
  const [loaded] = useFonts({
    SpaceMono: require('../assets/fonts/SpaceMono-Regular.ttf'),
  })

  useEffect(() => {
    if (loaded) SplashScreen.hideAsync()
  }, [loaded])

  if (!loaded) return null

  return (
    <Stack>
      <Stack.Screen name="(tabs)" options={{ headerShown: false }} />
      <Stack.Screen name="modal" options={{ presentation: 'modal' }} />
    </Stack>
  )
}
```

### Tab Navigator

```tsx
// app/(tabs)/_layout.tsx
import { Tabs } from 'expo-router'
import { Ionicons } from '@expo/vector-icons'

export default function TabLayout() {
  return (
    <Tabs screenOptions={{ tabBarActiveTintColor: '#007AFF' }}>
      <Tabs.Screen
        name="index"
        options={{
          title: 'Home',
          tabBarIcon: ({ color, size }) => (
            <Ionicons name="home" size={size} color={color} />
          ),
        }}
      />
      <Tabs.Screen
        name="profile"
        options={{
          title: 'Profile',
          tabBarIcon: ({ color, size }) => (
            <Ionicons name="person" size={size} color={color} />
          ),
        }}
      />
    </Tabs>
  )
}
```

### Protected Routes

```tsx
// app/_layout.tsx
import { Stack } from 'expo-router'
import { useAuth } from '@/hooks/useAuth'

export default function RootLayout() {
  const { isLoggedIn } = useAuth()

  return (
    <Stack>
      <Stack.Protected guard={isLoggedIn}>
        <Stack.Screen name="(tabs)" />
        <Stack.Screen name="modal" />
      </Stack.Protected>

      <Stack.Protected guard={!isLoggedIn}>
        <Stack.Screen name="(auth)" />
      </Stack.Protected>
    </Stack>
  )
}
```

---

## Navigation Methods

```tsx
import { router, Link, useLocalSearchParams } from 'expo-router'

// Programmatic navigation
router.push('/profile')           // Push to stack
router.replace('/home')           // Replace current
router.back()                     // Go back
router.dismissAll()               // Clear stack

// With params
router.push({ pathname: '/user/[id]', params: { id: '123' } })

// Link component
<Link href="/profile">Go to Profile</Link>
<Link href={{ pathname: '/user/[id]', params: { id: '123' } }}>
  View User
</Link>

// Read params
const { id } = useLocalSearchParams<{ id: string }>()
```

---

## Component Patterns

### Functional Component

```tsx
import { View, Text, StyleSheet, Pressable } from 'react-native'

interface ButtonProps {
  title: string
  onPress: () => void
  variant?: 'primary' | 'secondary'
}

export function Button({ title, onPress, variant = 'primary' }: ButtonProps) {
  return (
    <Pressable
      style={({ pressed }) => [
        styles.button,
        variant === 'secondary' && styles.secondary,
        pressed && styles.pressed,
      ]}
      onPress={onPress}
    >
      <Text style={[styles.text, variant === 'secondary' && styles.textSecondary]}>
        {title}
      </Text>
    </Pressable>
  )
}

const styles = StyleSheet.create({
  button: {
    backgroundColor: '#007AFF',
    paddingHorizontal: 24,
    paddingVertical: 12,
    borderRadius: 8,
    alignItems: 'center',
  },
  secondary: {
    backgroundColor: 'transparent',
    borderWidth: 1,
    borderColor: '#007AFF',
  },
  pressed: {
    opacity: 0.8,
  },
  text: {
    color: 'white',
    fontSize: 16,
    fontWeight: '600',
  },
  textSecondary: {
    color: '#007AFF',
  },
})
```

### List with FlatList

```tsx
import { FlatList, View, Text, StyleSheet } from 'react-native'

interface Item {
  id: string
  title: string
}

interface ItemListProps {
  items: Item[]
  onItemPress: (id: string) => void
}

export function ItemList({ items, onItemPress }: ItemListProps) {
  return (
    <FlatList
      data={items}
      keyExtractor={(item) => item.id}
      renderItem={({ item }) => (
        <Pressable onPress={() => onItemPress(item.id)}>
          <View style={styles.item}>
            <Text style={styles.title}>{item.title}</Text>
          </View>
        </Pressable>
      )}
      ItemSeparatorComponent={() => <View style={styles.separator} />}
      ListEmptyComponent={() => (
        <Text style={styles.empty}>No items found</Text>
      )}
    />
  )
}
```

---

## State Management with Zustand

```tsx
// stores/auth.ts
import { create } from 'zustand'
import { persist, createJSONStorage } from 'zustand/middleware'
import AsyncStorage from '@react-native-async-storage/async-storage'

interface AuthState {
  user: User | null
  token: string | null
  isLoading: boolean
  login: (email: string, password: string) => Promise<void>
  logout: () => void
}

export const useAuthStore = create<AuthState>()(
  persist(
    (set) => ({
      user: null,
      token: null,
      isLoading: false,

      login: async (email, password) => {
        set({ isLoading: true })
        try {
          const { user, token } = await api.login(email, password)
          set({ user, token, isLoading: false })
        } catch (error) {
          set({ isLoading: false })
          throw error
        }
      },

      logout: () => {
        set({ user: null, token: null })
      },
    }),
    {
      name: 'auth-storage',
      storage: createJSONStorage(() => AsyncStorage),
    }
  )
)
```

---

## API Calls

```tsx
// lib/api.ts
const BASE_URL = process.env.EXPO_PUBLIC_API_URL

async function request<T>(endpoint: string, options?: RequestInit): Promise<T> {
  const response = await fetch(`${BASE_URL}${endpoint}`, {
    ...options,
    headers: {
      'Content-Type': 'application/json',
      ...options?.headers,
    },
  })

  if (!response.ok) {
    throw new Error(`HTTP error! status: ${response.status}`)
  }

  return response.json()
}

export const api = {
  get: <T>(endpoint: string) => request<T>(endpoint),
  post: <T>(endpoint: string, data: unknown) =>
    request<T>(endpoint, { method: 'POST', body: JSON.stringify(data) }),
}
```

---

## Forms with React Hook Form

```tsx
import { View, TextInput, Text } from 'react-native'
import { useForm, Controller } from 'react-hook-form'
import { zodResolver } from '@hookform/resolvers/zod'
import { z } from 'zod'

const schema = z.object({
  email: z.string().email('Invalid email'),
  password: z.string().min(8, 'Password must be 8+ characters'),
})

type FormData = z.infer<typeof schema>

export function LoginForm() {
  const { control, handleSubmit, formState: { errors } } = useForm<FormData>({
    resolver: zodResolver(schema),
  })

  const onSubmit = (data: FormData) => {
    console.log(data)
  }

  return (
    <View style={{ gap: 16 }}>
      <Controller
        control={control}
        name="email"
        render={({ field: { onChange, onBlur, value } }) => (
          <View>
            <TextInput
              placeholder="Email"
              onBlur={onBlur}
              onChangeText={onChange}
              value={value}
              keyboardType="email-address"
              autoCapitalize="none"
            />
            {errors.email && <Text style={{ color: 'red' }}>{errors.email.message}</Text>}
          </View>
        )}
      />

      <Controller
        control={control}
        name="password"
        render={({ field: { onChange, onBlur, value } }) => (
          <View>
            <TextInput
              placeholder="Password"
              onBlur={onBlur}
              onChangeText={onChange}
              value={value}
              secureTextEntry
            />
            {errors.password && <Text style={{ color: 'red' }}>{errors.password.message}</Text>}
          </View>
        )}
      />

      <Button title="Login" onPress={handleSubmit(onSubmit)} />
    </View>
  )
}
```

---

## Safe Area Handling

```tsx
import { SafeAreaView } from 'react-native-safe-area-context'

export default function Screen() {
  return (
    <SafeAreaView style={{ flex: 1 }} edges={['top', 'bottom']}>
      {/* Content */}
    </SafeAreaView>
  )
}
```

---

## Platform-Specific Code

```tsx
import { Platform, StyleSheet } from 'react-native'

const styles = StyleSheet.create({
  container: {
    paddingTop: Platform.OS === 'ios' ? 20 : 0,
    ...Platform.select({
      ios: { shadowColor: '#000', shadowOffset: { width: 0, height: 2 } },
      android: { elevation: 4 },
    }),
  },
})

// Platform-specific files
// Button.ios.tsx
// Button.android.tsx
// Import as: import { Button } from './Button'
```

---

## Commands

```bash
# Development
npx expo start                # Start dev server
npx expo start --ios          # iOS simulator
npx expo start --android      # Android emulator

# Build
eas build --platform ios      # Build iOS
eas build --platform android  # Build Android

# Update
eas update                    # OTA update
```

---

## Common Mistakes

| Mistake | Fix |
|---------|-----|
| Using `TouchableOpacity` | Use `Pressable` (more flexible) |
| Inline styles everywhere | Use `StyleSheet.create` |
| Not handling safe areas | Wrap with `SafeAreaView` |
| Ignoring keyboard | Use `KeyboardAvoidingView` |
| No loading states | Show spinners during async |
| Direct AsyncStorage calls | Use Zustand with persist |
